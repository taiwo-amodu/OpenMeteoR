---
title: "Weather Forecasting with OpenMeteoR"
author: "Taiwo Amodu"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Weather Forecasting with OpenMeteoR}
  %\VignetteEngine{rmarkdown::html_vignette}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(OpenMeteoR)
```

## Introduction

The `OpenMeteoR` package provides an object-oriented interface for retrieving and visualizing short-term weather forecasts using the [Open-Meteo API](https://open-meteo.com/) and OpenStreetMap’s Nominatim geocoding service. The package is software-oriented, using custom S3 classes and methods for extensibility.

Key features:
- Retrieve forecasts using **coordinates** or **location names**
- Encapsulate results in structured **`forecast_result` S3 class**
- Support for custom **methods**: `print()`, `summary()`, `plot()`
- No API key required

This vignette walks through its core functionalities and software design.

## Installation

Install from source:

```r
install.packages("OpenMeteoR_0.1.0.tar.gz", repos = NULL, type = "source")
```

Then load the package:

```r
library(OpenMeteoR)
```

## Software Design Overview

The package defines a new S3 class: **`forecast_result`**, which contains:
- `location`: Name of the queried location
- `data`: A data frame of forecast values

Custom methods include:

| Method         | Description                                 |
|----------------|---------------------------------------------|
| `print()`      | Cleanly displays forecast results           |
| `summary()`    | Returns a summary of temperature & rain     |
| `plot()`       | Visualizes trends using ggplot2             |

## Getting Forecast by Location Name

```r
result <- get_forecast_by_location("Berlin", days = 3)
print(result)  # Uses print.forecast_result
```

```r
summary(result)  # Uses summary.forecast_result
```

```r
plot(result)  # Uses plot.forecast_result
```

### Sample Output (from `print()`)

```
$location
[1] "Berlin"

$data
        date temp_max temp_min precipitation
1 2025-07-13     21.3     16.2          18.7
2 2025-07-14     25.6     16.0           4.1
3 2025-07-15     21.2     16.0           5.3
```

## Getting Forecast by Coordinates

```r
result <- get_forecast(lat = 48.8566, lon = 2.3522, days = 3)
summary(result)
```

## How It Works

### 1. Geocoding Place Names

The `get_forecast_by_location()` function uses OpenStreetMap’s Nominatim API to geocode the input:

```r
https://nominatim.openstreetmap.org/search?q=Berlin&format=json&limit=1
```

This provides latitude and longitude for the location.

### 2. Querying Weather Forecasts

The `get_forecast()` function calls:

```r
https://api.open-meteo.com/v1/forecast
```

with query parameters like:
- `latitude`, `longitude`
- `daily=temperature_2m_max,temperature_2m_min,precipitation_sum`
- `forecast_days=n`

### 3. S3 Class Output

Results are stored as:

```r
structure(
  list(location = "Berlin", data = <data.frame>),
  class = "forecast_result"
)
```

## Visualizing the Forecast

```r
plot(result)
```

Generates a dual-axis plot:
- Line chart for max/min temperatures
- Bar chart for precipitation

## Error Handling

- If an invalid place is entered (e.g., `"Texa"`), the function still tries to find a best match.
- Users are advised to use precise names for reliable results.

## Dependencies

- `httr2` – for HTTP requests
- `jsonlite` – for JSON parsing
- `ggplot2` – for plotting
- `rlang` – for error tracing (optional)

## Limitations

- Only supports **daily** weather forecasts
- Forecast data limited to **7–16 days**, depending on API
- Accuracy depends on Open-Meteo and OpenStreetMap geocoding
- Requires internet connection

## Summary

The `OpenMeteoR` package provides a clean, object-oriented interface for accessing weather forecasts. Beyond basic data analysis, it serves as a reusable software layer with custom S3 classes and extensible methods.

This makes it suitable for:
- Integration into larger R workflows
- Dashboards and Shiny apps
- Teaching software design in R

## Session Info

```{r session-info}
sessionInfo()
```
